{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>GNB</title>
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Oswald:400,300" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- <script src="{% static 'js/index.js' %}"></script> -->
</head>

<body>
    <!-- Верхняя панель -->
    <header class="top-bar">
        <div class="left">
            <button onclick="window.location.href='{% url 'profil' %}'">Построить профиль</button>
        </div>
        <div class="right">
            <button id="loginBtn">Вход / Регистрация</button>
        </div>
    </header>

    <!-- Модальное окно -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>Вход / Регистрация</h3>
            <form id="loginForm" method="post" action="{% url 'login' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="username">Имя пользователя:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Пароль:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Войти</button>
                <button type="button" class="btn btn-secondary" id="registerBtn">Регистрация</button>
            </form>
        </div>
    </div>

    <!-- Основное содержимое -->
    <main class="main-content">
        <!-- Поисковая строка -->
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Поиск по документам...">
            <button id="searchBtn" class="search-btn">Найти</button>
        </div>

        <!-- Вкладки -->
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="main">Главная</button>
                <button class="tab-btn" data-tab="projects">Проекты</button>
                <button class="tab-btn" data-tab="attachments">Привязки</button>
                <button class="tab-btn" data-tab="profiles">Профили</button>
                <button class="tab-btn" data-tab="protocols">Протоколы</button>
            </div>

            <!-- Содержимое вкладок -->
            <div class="tab-content active" id="main-tab">
                <div class="welcome-section">
                    <h1>Добро пожаловать в систему ГНБ!</h1>
                    <p>Это приложение помогает управлять документами по горизонтально-направленному бурению.</p>
                    <img src="{% static 'img/foto2.jpg' %}" alt="Горизонтально-направленное бурение" class="welcome-image">
                </div>
            </div>

            <div class="tab-content" id="projects-tab">
                <button class="btn btn-upload" onclick="location.href='{% url 'upload_project' %}'">
                    <i class="fas fa-upload"></i> Загрузить проект
                </button>

                <div class="document-list">
                    {% for project in projects %}
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <div class="document-info">
                            <h3>{{ project.title }}</h3>
                            <p>{{ project.description|truncatechars:100|default:"Описание отсутствует" }}</p>
                            <div class="document-meta">
                                <span><i class="fas fa-calendar-alt"></i> {{ project.created_at|date:"d.m.Y" }}</span>
                                <a href="{{ project.file.url }}" download class="download-btn">
                                    <i class="fas fa-download"></i> Скачать
                                </a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-message">
                        <p>Нет загруженных проектов</p>
                        <a href="{% url 'upload_project' %}" class="btn btn-upload">
                            <i class="fas fa-plus-circle"></i> Добавить первый проект
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="tab-content" id="attachments-tab">
                <button class="btn btn-upload" onclick="location.href='{% url 'upload_attachment' %}'">
                    <i class="fas fa-upload"></i> Загрузить привязку
                </button>

                <div class="document-list">
                    {% for attachment in attachments %}
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="document-info">
                            <h3>{{ attachment.title }}</h3>
                            <p>Проект: <strong>{{ attachment.project.title }}</strong></p>
                            <p>{{ attachment.description|truncatechars:100|default:"Описание отсутствует" }}</p>
                            <div class="document-meta">
                                <span><i class="fas fa-calendar-alt"></i> {{ attachment.created_at|date:"d.m.Y" }}</span>
                                <a href="{{ attachment.file.url }}" download class="download-btn">
                                    <i class="fas fa-download"></i> Скачать
                                </a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-message">
                        <p>Нет загруженных привязок</p>
                        <a href="{% url 'upload_attachment' %}" class="btn btn-upload">
                            <i class="fas fa-plus-circle"></i> Добавить первую привязку
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="tab-content" id="profiles-tab">
                <div class="profiles-container">
                    {% for profile in profiles %}
                    <div class="profile-card">
                        <div class="profile-header">
                            <h3>{{ profile.address }}</h3>
                            <span class="profile-date">{{ profile.created_at|date:"d.m.Y H:i" }}</span>
                        </div>
                        <p class="profile-description">{{ profile.description|default:"Описание отсутствует" }}</p>
                        <div class="profile-image-wrapper">
                            <img src="{{ profile.image.url }}" alt="Профиль прокола {{ profile.address }}">
                            <div class="profile-actions">
                                <a href="{{ profile.image.url }}" download class="download-btn">Скачать</a>
                                {% if profile.id %}
                                <a href="{% url 'view_profile' profile.id %}" class="view-btn">Подробнее</a>
                                {% else %}
                                <span class="view-btn disabled">Подробнее</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-profiles">
                        <p>Нет сохраненных профилей</p>
                        <a href="{% url 'profil' %}" class="btn build-btn">Создать профиль</a>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="tab-content" id="protocols-tab">
                <div class="protocols-container">
                    <!-- Аналогичная структура для протоколов -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div id="footer">
            <h3>PRODUCED BY</h3>
            <p>Podporina Margarita Vladimirovna</p>
            <div id="footer-logo">
                <a href="/"><img src="{% static 'img/logo.png' %}" alt=""></a>
                <p>Copyright © 2025 GNB. For HDD creation</p>
            </div>
        </div>
    </footer>

    <script src="{% static 'js/index.js' %}"></script>
</body>
</html>